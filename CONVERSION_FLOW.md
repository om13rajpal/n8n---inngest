# n8n to Inngest Converter - Conversion Flow Diagram

## High-Level Conversion Process

```
┌─────────────────────────────────────────────────────────────────┐
│                     START: n8n Workflow JSON                     │
└────────────────────────────────┬────────────────────────────────┘
                                 │
                                 ▼
                    ┌────────────────────────┐
                    │   Validate JSON Schema  │
                    └────────┬───────────────┘
                             │
                ┌────────────┴────────────┐
                │                         │
                ▼                         ▼
          ┌─────────┐              ┌──────────┐
          │ Valid?  │              │ Invalid  │
          └────┬────┘              └─────┬────┘
               │                         │
               │ Yes                     │ No
               │                         ▼
               │                   ┌────────────────┐
               │                   │ Report Errors  │
               │                   │ EXIT (code 1)  │
               │                   └────────────────┘
               │
               ▼
    ┌──────────────────────┐
    │  Parse Workflow       │
    │  - Extract Nodes      │
    │  - Extract Connections│
    │  - Extract Metadata   │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │  Build Graph          │
    │  - Create Nodes       │
    │  - Create Edges       │
    │  - Calculate Degrees  │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │  Topological Sort     │
    │  (Determine Order)    │
    └──────────┬───────────┘
               │
               ▼
          ┌─────────┐
          │ Cycles? │
          └────┬────┘
               │
    ┌──────────┴──────────┐
    │                     │
    ▼                     ▼
┌─────────┐          ┌──────────┐
│   Yes   │          │    No    │
└────┬────┘          └─────┬────┘
     │                     │
     ▼                     │
┌────────────────┐         │
│ Error: Cycles  │         │
│ EXIT (code 1)  │         │
└────────────────┘         │
                           │
                           ▼
              ┌────────────────────────┐
              │  Analyze Workflow       │
              │  - Find Entry Points    │
              │  - Detect Branches      │
              │  - Detect Loops         │
              │  - Analyze Parallelism  │
              └────────────┬───────────┘
                           │
                           ▼
              ┌────────────────────────┐
              │  For Each Node in Order │
              └────────────┬───────────┘
                           │
                           ▼
              ┌────────────────────────┐
              │  Find Node Mapper       │
              └────────────┬───────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
        ┌──────────┐            ┌─────────────┐
        │ Mapper   │            │ No Mapper   │
        │ Found?   │            │ Found       │
        └────┬─────┘            └──────┬──────┘
             │                         │
             │ Yes                     │ No
             │                         ▼
             │                  ┌──────────────────┐
             │                  │ Use Fallback     │
             │                  │ Mapper           │
             │                  │ (Generate TODO)  │
             │                  └────────┬─────────┘
             │                           │
             └───────────┬───────────────┘
                         │
                         ▼
            ┌────────────────────────────┐
            │  Generate Code Fragment     │
            │  - Step code                │
            │  - Imports                  │
            │  - Env vars                 │
            │  - Warnings                 │
            └────────────┬───────────────┘
                         │
                         ▼
            ┌────────────────────────────┐
            │  Accumulate:                │
            │  - Code fragments           │
            │  - Imports (deduplicated)   │
            │  - Environment variables    │
            │  - Warnings                 │
            └────────────┬───────────────┘
                         │
                         ▼
                ┌─────────────────┐
                │ More Nodes?     │
                └────┬────────────┘
                     │
         ┌───────────┴───────────┐
         │                       │
         ▼                       ▼
      ┌────┐                ┌──────┐
      │ Yes│                │  No  │
      └──┬─┘                └───┬──┘
         │                      │
         │ (Loop Back)          │
         │                      │
         └──────────────────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Assemble Function      │
                   │  - Imports              │
                   │  - Client config        │
                   │  - Event trigger        │
                   │  - Step orchestration   │
                   │  - Error handling       │
                   └────────────┬───────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Render Templates       │
                   │  (Handlebars)           │
                   └────────────┬───────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Format Code            │
                   │  (Prettier)             │
                   └────────────┬───────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Type Check             │
                   │  (Optional)             │
                   └────────────┬───────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Generate Artifacts     │
                   │  - *.ts files           │
                   │  - package.json         │
                   │  - tsconfig.json        │
                   │  - .env.example         │
                   │  - README.md            │
                   │  - CONVERSION_REPORT.md │
                   └────────────┬───────────┘
                                │
                                ▼
                   ┌────────────────────────┐
                   │  Write to Filesystem    │
                   └────────────┬───────────┘
                                │
                                ▼
                      ┌──────────────────┐
                      │ Warnings Present?│
                      └────┬─────────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
         ┌────────┐                ┌─────────┐
         │  Yes   │                │   No    │
         └────┬───┘                └────┬────┘
              │                         │
              ▼                         │
    ┌──────────────────┐               │
    │ Display Warnings │               │
    │ EXIT (code 0)    │               │
    │ (Success with    │               │
    │  manual steps)   │               │
    └──────────────────┘               │
                                       │
                                       ▼
                              ┌─────────────────┐
                              │ Success Message │
                              │ EXIT (code 0)   │
                              └─────────────────┘
```

---

## Decision Tree: Node Type Handling

```
                    ┌──────────────────┐
                    │  Process Node     │
                    └────────┬─────────┘
                             │
                             ▼
              ┌──────────────────────────┐
              │ What is the node type?   │
              └──────────┬───────────────┘
                         │
         ┌───────────────┼───────────────┬──────────────┐
         │               │               │              │
         ▼               ▼               ▼              ▼
    ┌─────────┐    ┌──────────┐   ┌──────────┐   ┌──────────┐
    │ Trigger │    │ Action   │   │ Control  │   │ Other    │
    └────┬────┘    └────┬─────┘   └────┬─────┘   └────┬─────┘
         │              │              │              │
         │              │              │              │
         ▼              ▼              ▼              ▼
    ┌─────────────┐ ┌────────────┐ ┌───────────┐ ┌──────────────┐
    │ - Webhook   │ │ - HTTP Req │ │ - IF      │ │ - Merge      │
    │ - Schedule  │ │ - Email    │ │ - Switch  │ │ - Set        │
    │ - Manual    │ │ - Database │ │ - Loop    │ │ - Function   │
    └──────┬──────┘ └─────┬──────┘ └─────┬─────┘ └──────┬───────┘
           │              │              │              │
           └──────────────┼──────────────┼──────────────┘
                          │              │
                          ▼              ▼
              ┌────────────────────────────────┐
              │ Check Mapper Registry          │
              └────────────┬───────────────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
        ┌──────────┐              ┌──────────┐
        │ Mapper   │              │ No Mapper│
        │ Exists?  │              │          │
        └────┬─────┘              └─────┬────┘
             │                          │
             │ Yes                      │ No
             │                          │
             ▼                          ▼
    ┌────────────────┐        ┌──────────────────┐
    │ Call Mapper    │        │ Use Fallback     │
    │ generateCode() │        │ - Add Warning    │
    └────────┬───────┘        │ - Generate TODO  │
             │                └────────┬─────────┘
             │                         │
             └─────────┬───────────────┘
                       │
                       ▼
          ┌────────────────────────┐
          │ Return CodeFragment     │
          │ - stepCode             │
          │ - imports              │
          │ - environmentVars      │
          │ - warnings             │
          └────────────────────────┘
```

---

## Branch Handling Flow

```
                ┌────────────────────┐
                │ Detect IF/SWITCH   │
                └─────────┬──────────┘
                          │
                          ▼
             ┌────────────────────────┐
             │ Count Output Branches  │
             └─────────┬──────────────┘
                       │
        ┌──────────────┼──────────────┐
        │              │              │
        ▼              ▼              ▼
   ┌────────┐    ┌─────────┐    ┌─────────┐
   │ 1 Branch│    │2 Branches│   │3+ Branch│
   └────┬───┘    └────┬────┘    └────┬────┘
        │             │              │
        │             │              │
        ▼             ▼              ▼
   ┌─────────┐   ┌──────────┐   ┌──────────┐
   │ Warning │   │ IF/ELSE  │   │ IF/ELSE  │
   │ (No op) │   │ Pattern  │   │ IF Chain │
   └─────────┘   └────┬─────┘   └────┬─────┘
                      │              │
                      │              │
                      ▼              ▼
            ┌──────────────────────────────┐
            │ For Each Branch:             │
            │ 1. Extract condition         │
            │ 2. Trace path to merge/end   │
            │ 3. Generate branch code      │
            └──────────────┬───────────────┘
                           │
                           ▼
            ┌──────────────────────────────┐
            │ Generate Conditional:         │
            │                               │
            │ if (condition1) {             │
            │   // branch 1 steps           │
            │ } else if (condition2) {      │
            │   // branch 2 steps           │
            │ } else {                      │
            │   // default branch           │
            │ }                             │
            └───────────────────────────────┘
```

---

## Loop Handling Flow

```
            ┌────────────────────────┐
            │ Detect Loop Node       │
            │ (Split In Batches)     │
            └─────────┬──────────────┘
                      │
                      ▼
        ┌────────────────────────────┐
        │ Extract Loop Configuration │
        │ - Items source             │
        │ - Batch size               │
        │ - Loop nodes               │
        └─────────┬──────────────────┘
                  │
                  ▼
        ┌─────────────────────────┐
        │ Find Items Expression   │
        │ (What to loop over)     │
        └─────────┬───────────────┘
                  │
                  ▼
        ┌─────────────────────────┐
        │ Trace Loop Body         │
        │ (Nodes within loop)     │
        └─────────┬───────────────┘
                  │
                  ▼
        ┌─────────────────────────┐
        │ Generate Loop Code:      │
        │                          │
        │ for (const item of items)│
        │ {                        │
        │   await step.run(...) {  │
        │     // process item      │
        │   }                      │
        │ }                        │
        └──────────────────────────┘
```

---

## Error Handling Decision Tree

```
                ┌────────────────────┐
                │ Check Node Config  │
                └─────────┬──────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
    ┌──────────┐    ┌──────────┐    ┌──────────┐
    │ Retry on │    │ Continue │    │ On Error │
    │ Fail?    │    │ on Fail? │    │ Workflow?│
    └────┬─────┘    └────┬─────┘    └────┬─────┘
         │               │               │
         │ Yes           │ Yes           │ Yes
         ▼               ▼               ▼
    ┌──────────┐    ┌──────────┐    ┌──────────┐
    │ Add      │    │ Wrap in  │    │ Generate │
    │ Retry    │    │ try/catch│    │ onFailure│
    │ Config   │    │          │    │ Handler  │
    └──────────┘    └──────────┘    └──────────┘
         │               │               │
         ▼               ▼               ▼
    ┌──────────────────────────────────────┐
    │ step.run("...", async () => {        │
    │   // code                            │
    │ }, {                                 │
    │   retries: 3,                        │
    │   retryDelay: 1000                   │
    │ })                                   │
    └──────────────────────────────────────┘
```

---

## Credential Handling Flow

```
            ┌────────────────────────┐
            │ Scan Node for          │
            │ Credentials            │
            └─────────┬──────────────┘
                      │
                      ▼
              ┌───────────────┐
              │ Credentials   │
              │ Present?      │
              └───┬───────────┘
                  │
      ┌───────────┴────────────┐
      │                        │
      ▼                        ▼
 ┌────────┐              ┌──────────┐
 │  Yes   │              │    No    │
 └────┬───┘              └─────┬────┘
      │                        │
      │                        │ (Skip)
      ▼                        │
┌──────────────────┐           │
│ Extract Cred Info│           │
│ - ID             │           │
│ - Name           │           │
│ - Type           │           │
└────┬─────────────┘           │
     │                         │
     ▼                         │
┌──────────────────┐           │
│ Generate Env Var │           │
│ Name             │           │
│ (CRED_NAME_TYPE) │           │
└────┬─────────────┘           │
     │                         │
     ▼                         │
┌──────────────────┐           │
│ Replace in Code  │           │
│ with             │           │
│ process.env.VAR  │           │
└────┬─────────────┘           │
     │                         │
     ▼                         │
┌──────────────────┐           │
│ Add to           │           │
│ .env.example     │           │
└────┬─────────────┘           │
     │                         │
     └─────────┬───────────────┘
               │
               ▼
        ┌──────────────┐
        │ Continue     │
        └──────────────┘
```

---

## Mapper Selection Logic

```
                ┌────────────────────┐
                │ Get Node Type      │
                └─────────┬──────────┘
                          │
                          ▼
              ┌────────────────────────┐
              │ Query Mapper Registry  │
              └─────────┬──────────────┘
                        │
            ┌───────────┴───────────┐
            │                       │
            ▼                       ▼
    ┌───────────────┐       ┌──────────────┐
    │ Exact Match   │       │ No Match     │
    │ Found?        │       │              │
    └───────┬───────┘       └──────┬───────┘
            │                      │
            │ Yes                  │ No
            ▼                      │
    ┌───────────────┐              │
    │ Check Version │              │
    │ Compatibility │              │
    └───────┬───────┘              │
            │                      │
    ┌───────┴────────┐             │
    │                │             │
    ▼                ▼             │
┌─────────┐    ┌──────────┐       │
│Compatible│   │Incompatib│       │
└────┬────┘    └─────┬────┘       │
     │               │             │
     │ Yes           │ No          │
     │               │             │
     ▼               ▼             ▼
┌──────────┐   ┌──────────────────────┐
│ Use      │   │ Use Fallback Mapper  │
│ Mapper   │   │ - Generate TODO      │
└──────────┘   │ - Add Warning        │
               │ - Create Placeholder │
               └──────────────────────┘
```

---

## Parallelization Detection

```
            ┌────────────────────────┐
            │ Group Nodes by Depth   │
            └─────────┬──────────────┘
                      │
                      ▼
         ┌────────────────────────────┐
         │ For Each Depth Level:      │
         │ Get nodes at same depth    │
         └─────────┬──────────────────┘
                   │
                   ▼
            ┌──────────────┐
            │ Node Count   │
            │ at Depth?    │
            └──────┬───────┘
                   │
       ┌───────────┴────────────┐
       │                        │
       ▼                        ▼
  ┌────────┐              ┌──────────┐
  │ Count=1│              │ Count>1  │
  └────┬───┘              └─────┬────┘
       │                        │
       │ (Sequential)           │
       │                        ▼
       │              ┌──────────────────┐
       │              │ Check for Shared │
       │              │ Dependencies     │
       │              └────┬─────────────┘
       │                   │
       │        ┌──────────┴──────────┐
       │        │                     │
       │        ▼                     ▼
       │   ┌─────────┐          ┌──────────┐
       │   │ Shared  │          │Independent│
       │   │ Deps?   │          │          │
       │   └────┬────┘          └─────┬────┘
       │        │                     │
       │        │ Yes                 │ No
       │        │                     │
       │        ▼                     ▼
       │   ┌─────────┐          ┌──────────┐
       │   │Sequential│         │ Parallel │
       │   └─────────┘          │ Group    │
       │                        └──────────┘
       │                             │
       │                             ▼
       │                   ┌──────────────────┐
       │                   │ Generate         │
       │                   │ Promise.all([])  │
       │                   └──────────────────┘
       │
       └─────────────────────────┬─────────────
                                 │
                                 ▼
                        ┌─────────────────┐
                        │ Continue        │
                        └─────────────────┘
```

---

## Output Generation Flow

```
            ┌────────────────────────┐
            │ Conversion Complete    │
            └─────────┬──────────────┘
                      │
                      ▼
        ┌────────────────────────────┐
        │ Create Output Directory    │
        └─────────┬──────────────────┘
                  │
                  ▼
        ┌────────────────────────────┐
        │ Generate Files:            │
        └─────────┬──────────────────┘
                  │
     ┌────────────┼────────────┬─────────────┐
     │            │            │             │
     ▼            ▼            ▼             ▼
┌──────────┐ ┌─────────┐ ┌──────────┐ ┌──────────┐
│ TS Files │ │package  │ │tsconfig  │ │.env      │
│          │ │.json    │ │.json     │ │.example  │
└────┬─────┘ └────┬────┘ └────┬─────┘ └────┬─────┘
     │            │            │             │
     └────────────┼────────────┼─────────────┘
                  │            │
                  │            ▼
                  │    ┌──────────────┐
                  │    │ README.md    │
                  │    └──────┬───────┘
                  │           │
                  │           ▼
                  │    ┌──────────────┐
                  │    │ CONVERSION   │
                  │    │ _REPORT.md   │
                  │    └──────┬───────┘
                  │           │
                  └───────────┼──────────────┐
                              │              │
                              ▼              ▼
                    ┌──────────────┐  ┌──────────┐
                    │ Write to     │  │ Display  │
                    │ Filesystem   │  │ Summary  │
                    └──────┬───────┘  └────┬─────┘
                           │               │
                           └───────┬───────┘
                                   │
                                   ▼
                          ┌─────────────────┐
                          │ Done! EXIT(0)   │
                          └─────────────────┘
```

---

## CLI Command Flow

```
                ┌────────────────────┐
                │ User Runs CLI      │
                │ n8n-to-inngest     │
                └─────────┬──────────┘
                          │
                          ▼
              ┌────────────────────────┐
              │ Parse Command & Args   │
              └─────────┬──────────────┘
                        │
        ┌───────────────┼───────────────┬──────────────┐
        │               │               │              │
        ▼               ▼               ▼              ▼
  ┌──────────┐    ┌──────────┐   ┌──────────┐   ┌──────────┐
  │ convert  │    │ validate │   │  list    │   │   init   │
  └────┬─────┘    └────┬─────┘   │  mappers │   └────┬─────┘
       │               │          └────┬─────┘        │
       │               │               │              │
       ▼               ▼               ▼              ▼
  ┌──────────┐    ┌──────────┐   ┌──────────┐   ┌──────────┐
  │ Load     │    │ Load     │   │ Query    │   │ Scaffold │
  │ Workflow │    │ Workflow │   │ Registry │   │ Project  │
  └────┬─────┘    └────┬─────┘   └────┬─────┘   └────┬─────┘
       │               │               │              │
       ▼               ▼               ▼              ▼
  ┌──────────┐    ┌──────────┐   ┌──────────┐   ┌──────────┐
  │ Convert  │    │ Validate │   │ Print    │   │ Generate │
  │ Process  │    │ Schema   │   │ List     │   │ Files    │
  └────┬─────┘    └────┬─────┘   └────┬─────┘   └────┬─────┘
       │               │               │              │
       ▼               ▼               ▼              ▼
  ┌──────────┐    ┌──────────┐   ┌──────────┐   ┌──────────┐
  │ Generate │    │ Report   │   │ EXIT(0)  │   │ EXIT(0)  │
  │ Output   │    │ Result   │   └──────────┘   └──────────┘
  └────┬─────┘    └────┬─────┘
       │               │
       ▼               ▼
  ┌──────────┐    ┌──────────┐
  │ Report   │    │ EXIT     │
  │ Warnings │    │ (0 or 1) │
  └────┬─────┘    └──────────┘
       │
       ▼
  ┌──────────┐
  │ EXIT(0)  │
  └──────────┘
```

---

**Document Status**: Reference for Implementation
**Usage**: Use this flow diagram to understand conversion pipeline logic
